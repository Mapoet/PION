\documentclass[a4paper,11pt]{article}
%\documentclass[a4paper,11pt,draft]{article}



\usepackage{graphicx}
%\usepackage[numbers,comma]{natbib}
\usepackage{natbib}
%\bibpunct{(}{)}{;}{a}{,}{,}
\bibliographystyle{../../../../active/documentation_misc/bibtex/apj.bst}
\usepackage{amsmath}
\usepackage{amssymb}

\input{../../../../active/documentation_misc/bibtex/defs}

\usepackage[T1]{fontenc}
\usepackage{times}
%
% BORDERS:
% HORIZONTAL:	210mm - 50.8mm = 159.2mm ROUNDED TO 16cm
% VERTICAL:	297mm - 50.8mm = 246.2mm ROUNDED TO 25cm
%
\setlength{\oddsidemargin}{0.0cm}
\setlength{\textwidth}{16.0cm}
\setlength{\topmargin}{-1.5cm}
\setlength{\textheight}{25.0cm}
\parindent = 0.0 truept
\parskip = 6.0 truept

\let\oldenumerate\enumerate
\renewcommand{\enumerate}{
  \oldenumerate
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
}

\title{Development log for \pion{}}
\author{Jonathan Mackey (AIfA)}

\begin{document}
\maketitle


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
\section{Preparing for Release 0.2}
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
\subsection{List of Tasks}
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{First I need to deal with global.h/.cc to get rid of all the global stuff.}
\begin{enumerate}
\item 2015.06.07: Got rid of global.h/global.cc and got serial code to compile again.
\item I have already made a lot of progress since mid-January, by spending a short while every day working on \pion{} (max.~1 hour per day).
\item XXX JetParams class: what is that doing here?  Where can it go?  I guess into simparams.h
\item XXX Stellar wind parameters class needs to go somewhere.
\item XXX GeneralStuff needs to be got rid of entirely; I can make an interpolation class in the tools/ directory, and also a timers class in tools/ [\textbf{DONE 02.03.15}], and the constants can go into sim-constants.
  The only thing that doesn't have an obvious home is equalD(); it is a very useful function, maybe it can be on its own somewhere?
\item XXX Remove the global microphysics pointer; maybe put it in sim-control? (in microphysics\_base.h)
\item XXX Move the raytracing base class to its own header file, and get rid of the global pointer; again maybe put it in sim-control.
\end{enumerate}

\subsubsection{Then a few things that need fixing}
\begin{enumerate}
\item Change the boundary conditions setup so that each boundary has its own line in the parameter files.
\item Change the microphysics and tracer variable setup so that each tracer variable has its own line in the parameter file (and maybe include some variables automatically when needed by microphysics?).
\end{enumerate}

\subsubsection{I need a new uniform\_grid class.}
\begin{enumerate}
\item look at what I did before!
\item Change the boundaries so that the full grid (including ghost cells) is a line/square/cube without any empty corner sections.
\item Get the new boundaries working in parallel with MPI (first without RT).
\item Test this with 1D, 2D, 3D problems such as the DMR, advection, and blastwave tests.
\item Get the new boundaries working in parallel with MPI including RT (this should be much simpler than the original scheme, and so the scaling should improve quite a bit).
\item Test this with the spherical HII region expansion tests.
\end{enumerate}

\subsubsection{H-correction}
\begin{enumerate}
\item Make sure it still works in serial, with test problems.
\item See if it helps with symmetry-axis problems in problems with cooling.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
\subsection{Log of Progress}
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\paragraph{2015.02.18 code structure}
I am largely re-writing the code structure, with the goal that global.h/.cpp should be completely empty files that I can remove before v0.2 is released.
These global pointers are starting to be problematic, and the logic of how the code is parallelised didn't really work anymore.
So far I have:
\begin{enumerate}
\item removed the global grid pointer,
\item put memory management into its own source files, 
\item put reporting into its own source files,
\item put the command-line interface into its own source files.
\item added a sim\_constants.h file,
\item split grid.h/cc into a grid setup class and a simulation control class, both with serial and parallel versions,
\item put the ParallelParams class into new files, and renamed the class MCMDcontrol, for Multiple-Core, Multiple-Domain,
\item put the SimParams into its own header file,
\item changed main, mainMPI, and icgen, to use the new code structures.
\end{enumerate}

I'm not sure when to start testing the code again.
I think I should do it now, with the DMR test, in serial and parallel, to make sure that the basic running of the code works before I start working on microphysics, raytracing, and then hacking at the uniform grid.
I also think I should fix the BCs and TRTYPE parameters in the setup files before moving any further, because that will require changes to the setup files of all of the test problems.

\paragraph{2015.03.02}
Moved timers to their own file from GeneralStuff.
Tested that the code compiles ok and everything seems fine.

\paragraph{2015.04.30}
Moved command-line function into sim\_control class.

\paragraph{2015.06.13}
Changed silo classes so that DOUBLE/FLOAT is set in the constructor, not at compile time.
Had to make lots of arrays into void*, and added lots of reinterpret\_cast<> calls.
This is needed for writing a program to change the files from double to float to save on storage.
This is debugged so that the serial code compiles and runs, and checks when it reads a file to make sure that it has the datatype that is expected (to avoid reading in junk when we reinterpret the void pointer).


\paragraph{2015.06.15}
There is a problem with the parallel code and the DMR test when I run with floats, but it doesn't seem to occur with doubles.  The first x-row is not plotted by visit, but the second row is dublicated on top of the first.
I know the first row is there because it has the densest point and this shows up on the max/min in the legend, but it is not shown.
So there is a problem with the extents or node-lists.
Also, it bugs out with 4 cores because it says the XX mesh is not at the right place\ldots I should debug this soon.

2015.06.15: I fixed it: was a bug setting void pointers in 3D even if the node\_coords array was only 2D.
So now the code plots correctly in VisIt, and restarts with n>1 cores.
I need to get silocompare working with floats/doubles so that I can prove that the serial and parallel codes are identical (maybe also that float/double codes are as similar as they can be!).

Next up: silocompare, and then writing a code that translates all the double precision silo files into single precision for long-term storage.

\paragraph{2015.07.06}
I have silocompare, silo\_dbl2flt, and Project3Ddata analysis codes working with the new pion structure.
It now works great!  I should actually use dataio\_silo\_utility.cpp now in pion-parallel to read in datafiles; that way it doesn't matter how many cores the code was run with before.

I moved everything from global.h/.cc to other files, and fixed up all header files so that they no longer souce global.h.
Serial and parallel code now compiles without problems, haven't yet tested running it.

Started working on the tracer code, to give each tracer its own line in the parameter file.
It will not be trivial, but I think I can do it this week.

\paragraph{2015.07.[07-09]}
Worked on the tracer variables.  It is a lot of work to change this, but I'm making progress.
Serial code now compiles and icgen will make a silo file with the new tracer variables in it.
Parallel code also, and I have checked that it runs identically with new and old code (for both colour tracers and H$^{+}$ with explicit MPv3).
I have checked that it runs in serial, in parallel with 1 and 4 cores, and that it can restart from a checkpoint file for all of these cases.
So I think it works!

\paragraph{2015.07.16}
3D projection code now runs faster than before because I multithreaded some of the setup code.
It runs on SuperMUC now, and only crashes if it runs out of memory.
I started a "float" version of pion, where in defines/functionality-flags.h you can set whether cells should use double or single precision.
It needs a lot of changes to a lot of functions though.
I think I need a full day to make this change, but it will be worth it in the long run, and it should allow the projection code to run bigger simulations\ldots
If I can use $\sim50$\% less memory then I'll be able to analyse the $768^3$ sims, I think.
So it will have to wait until after I get back from my holidays.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
\section{Preparing for Release 0.1}
%%%%%%%%%%%%%%%%%%%------------------------------%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\paragraph{2013.02.07 (4 hours)}
I added some documentation to UsersGuide.tex.
It needs a lot of work before it will actually be useful.
But maybe I can add a paragraph about each test problem as I update it to work with pion.

Updated the stdout output from pion so that it is neater (at least for serial code, hydro, no microphysics, no raytracing).  I may need to do more work later when I run some MHD tests with RT/MP.

I updated the axisymmetric blast-wave test problem so that it runs on pion.
I still need to modify the scripts so that it produces output that would be useful for a user (e.g.\ Dominique), because at the moment it is set up for making sure the code still works after I make a change.

\paragraph{Other stuff\ldots}
I guess I made a lot of other changes too, but stopped updating this doc.
\pion{} v.0.1 was basically the version in \citet{Mac12}, with the hydrodynamics described in \citet{MacLim10}, MHD in \citet{MacLim11}, and with some extensions made in 2013, described in \citet{MacLanGva13}.




\bibliography{../../../../active/documentation_misc/bibtex/refs}
\end{document}


